(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["uni_modules-uni-id-pages-pages-userinfo-face-verify-face-verify"],{"15fd":function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==e)return{};var n,a,r=(0,i.default)(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r},n("a4d3"),n("c975");var i=function(e){return e&&e.__esModule?e:{default:e}}(n("ccb5"))},1785:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"uni-content"},[e.verifyFail?[i("v-uni-view",{staticClass:"face-icon"},[i("v-uni-image",{staticClass:"face-icon-image",attrs:{src:n("c749")}})],1),i("v-uni-view",{staticClass:"error-title"},[e._v(e._s(e.verifyFailTitle))]),i("v-uni-view",{staticClass:"error-description"},[e._v(e._s(e.verifyFailContent))]),10013!==e.verifyFailCode?i("v-uni-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.retry.apply(void 0,arguments)}}},[e._v("重新开始验证")]):i("v-uni-button",{attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.retry.apply(void 0,arguments)}}},[e._v("返回")]),e.isDev?i("v-uni-view",{staticClass:"dev-tip"},[e._v("请在控制台查看详细错误（此提示仅在开发环境展示）")]):e._e()]:[e.realName?i("v-uni-view",{staticClass:"self-required"},[e._v("确认"),i("v-uni-text",{staticClass:"name"},[e._v(e._s(e.realNameDesensitized))]),e._v("本人操作")],1):e._e(),i("v-uni-view",{staticClass:"face-icon"},[i("v-uni-image",{staticClass:"face-icon-image",attrs:{src:n("c749")}})],1),i("v-uni-view",{staticClass:"suggestion"},[i("v-uni-view",{staticClass:"text"},[e._v("温馨提示")]),e._l(e.suggestion,(function(t){return i("v-uni-view",{staticClass:"text"},[i("v-uni-text",{staticClass:"dot"}),i("v-uni-text",[e._v(e._s(t))])],1)}))],2),i("v-uni-view",{staticClass:"footer"},[i("v-uni-button",{attrs:{type:"primary",disabled:e.verifyButtonDisabled},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getCertifyId.apply(void 0,arguments)}}},[e._v("开始人脸识别")])],1)]],2)},a=[]},2169:function(e,t,n){"use strict";var i=n("ecb3"),a=n.n(i);a.a},"3fb2":function(e,t,n){"use strict";(function(e,i){n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("15fd")),o=a(n("c7eb")),u=a(n("1da1"));n("fb6a"),n("a630"),n("3ca3"),n("ac1f"),n("00b4"),n("e9c4");var s=n("e659"),c=a(n("dcbb")),d=["errCode"],l=e.importObject("uni-id-co"),f={data:function(){return{realName:"",idCard:"",certifyId:"",suggestion:["请正对屏幕并使脸位于取景框内","请保持光线充足，避免光照过强或过弱","请根据画面提示完成动作检测","人脸识别过程中请保持手机稳定","请注意拍摄角度，距离摄像头不要过远或过近"],verifyFail:!1,verifyFailCode:0,verifyFailTitle:"",verifyFailContent:""}},computed:{realNameDesensitized:function(){var e=this.realName.slice(0,-1),t=this.realName.slice(-1);return Array.from(new Array(e.length),(function(e){return"*"})).join("")+t},verifyButtonDisabled:function(){return!this.realName||!this.idCard},isDev:function(){return!1}},onLoad:function(e){this.realName=e.realName||"",this.idCard=e.idCard||""},methods:{getCertifyId:function(){var e=this;return(0,u.default)((0,o.default)().mark((function t(){var n;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.realName&&e.idCard){t.next=3;break}return uni.showModal({title:"验证失败",content:"缺少姓名或身份证号码",showCancel:!1}),t.abrupt("return");case 3:if((0,c.default)(e.idCard)){t.next=6;break}return uni.showToast({title:"身份证不合法",icon:"none"}),t.abrupt("return");case 6:if(/^[\u4e00-\u9fa5]+$/.test(e.realName)){t.next=9;break}return uni.showToast({title:"姓名只能是汉字",icon:"none"}),t.abrupt("return");case 9:return t.next=11,l.getFrvCertifyId({realName:e.realName,idCard:e.idCard});case 11:n=t.sent,e.certifyId=n.certifyId,e.startFacialRecognitionVerify(),uni.setStorage({key:"uni-id-pages-temp-frv",data:{realName:e.realName,idCard:e.idCard}});case 15:case"end":return t.stop()}}),t)})))()},startFacialRecognitionVerify:function(){this.verifyFailCode=0,this.verifyFail=!1,this.verifyFailTitle="",this.verifyFailContent=""},getFrvAuthResult:function(){var t=this;return(0,u.default)((0,o.default)().mark((function n(){var a,u,c;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.importObject("uni-id-co",{customUI:!0}),n.prev=1,uni.showLoading({title:"验证中...",mask:!1}),n.next=5,a.getFrvAuthResult({certifyId:t.certifyId});case 5:u=n.sent,u.errCode,c=(0,r.default)(u,d),t.verifyFailContent&&i.log("[frv-debug] 客户端刷脸失败，由实人认证服务查询具体原因，原因：".concat(t.verifyFailContent)),uni.showModal({content:"实名认证成功",showCancel:!1,success:function(){s.mutations.setUserInfo({realNameAuth:c}),uni.navigateBack(-1)}}),uni.removeStorage({key:"uni-id-pages-temp-frv"}),n.next=17;break;case 12:n.prev=12,n.t0=n["catch"](1),t.verifyFail=!0,t.verifyFailTitle=n.t0.errMsg,i.error(JSON.stringify(n.t0));case 17:return n.prev=17,uni.hideLoading(),n.finish(17);case 20:case"end":return n.stop()}}),n,null,[[1,12,17,20]])})))()},retry:function(){10013!==this.verifyFailCode?this.startFacialRecognitionVerify():uni.navigateBack(-1)}}};t.default=f}).call(this,n("a9ff")["default"],n("5a52")["default"])},"5dde":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.input-box[data-v-7659268c]  .uni-input-input[type="password"]::-ms-reveal{display:none}.uni-content[data-v-7659268c]{padding:0 %?60?%}.login-logo[data-v-7659268c]{display:none}@media screen and (min-width:690px){.uni-content[data-v-7659268c]{margin:0 auto;position:relative;top:100px;padding:30px 40px 80px 40px;max-width:450px;max-height:450px;border-radius:10px;box-shadow:0 0 20px #efefef;background-color:#fff}.login-logo[data-v-7659268c]{display:flex;justify-content:center}.login-logo uni-image[data-v-7659268c]{width:60px;height:60px}.register-back[data-v-7659268c]{display:none}uni-button[data-v-7659268c]{padding-bottom:1px}}.uni-content uni-view[data-v-7659268c]{box-sizing:border-box}.title[data-v-7659268c]{display:flex;padding:18px 0;font-weight:800;flex-direction:column}.tip[data-v-7659268c]{display:flex;color:#bdbdc0;font-size:11px;margin:6px 0}.uni-content[data-v-7659268c]  .uni-easyinput__content,\n.input-box[data-v-7659268c]{height:44px;background-color:#f8f8f8!important;border-radius:0;font-size:14px;display:flex;flex:1}.link[data-v-7659268c]{color:#04498c;cursor:pointer}.uni-content[data-v-7659268c]  .uni-forms-item__inner{padding-bottom:8px}.uni-btn[data-v-7659268c]{text-align:center;height:40px;line-height:40px;margin:15px 0 10px 0;color:#fff!important;border-radius:5px;font-size:16px}.uni-body.uni_modules-uni-id-pages-pages-login-login-withoutpwd[data-v-7659268c]{height:auto!important}.self-required[data-v-7659268c]{margin-top:20px;font-size:18px;font-weight:700;text-align:center;color:#333}.self-required .name[data-v-7659268c]{color:#2979ff}.face-icon[data-v-7659268c]{width:100px;height:100px;margin:50px auto 30px}.face-icon-image[data-v-7659268c]{width:100%;height:100%;display:block}.suggestion[data-v-7659268c]{color:#999;font-size:13px;margin-bottom:20px}.suggestion .text[data-v-7659268c]{line-height:20px;display:flex;align-items:center}.suggestion .text .dot[data-v-7659268c]{width:5px;height:5px;background:#2979ff;border-radius:50%;margin-right:5px}.error-title[data-v-7659268c]{font-size:18px;text-align:center;font-weight:700}.error-description[data-v-7659268c]{font-size:13px;color:#999;margin:10px 0 20px;text-align:center}.dev-tip[data-v-7659268c]{margin-top:20px;font-size:13px;color:#999;text-align:center}',""]),e.exports=t},"610f":function(e,t,n){"use strict";n.r(t);var i=n("1785"),a=n("e1d1");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("2169");var o=n("f0c5"),u=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,"7659268c",null,!1,i["a"],void 0);t["default"]=u.exports},c466:function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={debug:!1,isAdmin:!1,loginTypes:["weixin","username","smsCode"],agreements:{serviceUrl:"https://xxx",privacyUrl:"https://xxx",scope:["register","login","realNameVerify"]},appid:{weixin:{h5:"xxxxxx",web:"xxxxxx"}},passwordStrength:"medium",setPasswordAfterLogin:!1}},c749:function(e,t,n){e.exports=n.p+"static/img/face-verify-icon.38049b60.svg"},ccb5:function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a},n("b64b"),n("c975")},dcbb:function(e,t,n){"use strict";n("7a82"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e||"string"!==typeof e||18!==e.length)return!1;for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],n=e.substring(17),i=0,a=0;a<17;a++)i+=Number(e.charAt(a))*t[a];return[1,0,"x",9,8,7,6,5,4,3,2][i%11].toString()===n.toLowerCase()},n("a9e3"),n("d401"),n("d3b7"),n("25f0")},e1d1:function(e,t,n){"use strict";n.r(t);var i=n("3fb2"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},e659:function(e,t,n){"use strict";(function(e,i){n("7a82");var a=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.store=t.mutations=void 0;var r=a(n("c7eb")),o=a(n("5530")),u=a(n("1da1"));n("b64b"),n("d3b7"),n("159b"),n("99af");var s=a(n("c448")),c=a(n("c466")),d=a(n("e143")),l=e.importObject("uni-id-co"),f=e.database(),p=f.collection("uni-id-users"),v=uni.getStorageSync("uni-id-pages-userInfo")||{},g={userInfo:v,hasLogin:0!=Object.keys(v).length},x={updateUserInfo:function(){var t=arguments,n=this;return(0,u.default)((0,r.default)().mark((function a(){var u,s,c,d;return(0,r.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(u=t.length>0&&void 0!==t[0]&&t[0],!u){a.next=5;break}p.where("_id==$env.uid").update(u).then((function(e){e.result.updated?(uni.showToast({title:"更新成功",icon:"none",duration:3e3}),n.setUserInfo(u)):uni.showToast({title:"没有改变",icon:"none",duration:3e3})})),a.next=20;break;case 5:return s=e.importObject("uni-id-co",{customUI:!0}),a.prev=6,a.next=9,p.where("'_id' == $cloudEnv_uid").field("mobile,nickname,username,email,avatar_file").get();case 9:return c=a.sent,a.next=12,s.getRealNameInfo();case 12:d=a.sent,n.setUserInfo((0,o.default)((0,o.default)({},c.result.data[0]),{},{realNameAuth:d})),a.next=20;break;case 16:a.prev=16,a.t0=a["catch"](6),n.setUserInfo({},{cover:!0}),i.error(a.t0.message,a.t0.errCode);case 20:case"end":return a.stop()}}),a,null,[[6,16]])})))()},setUserInfo:function(e){var t=arguments;return(0,u.default)((0,r.default)().mark((function n(){var i,a,o;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t.length>1&&void 0!==t[1]?t[1]:{cover:!1},a=i.cover,o=a?e:Object.assign(h.userInfo,e),h.userInfo=Object.assign({},o),h.hasLogin=0!=Object.keys(h.userInfo).length,uni.setStorage({key:"uni-id-pages-userInfo",data:h.userInfo}),n.abrupt("return",e);case 6:case"end":return n.stop()}}),n)})))()},logout:function(){var t=this;return(0,u.default)((0,r.default)().mark((function n(){var a,o;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(e.getCurrentUserInfo().tokenExpired>Date.now())){n.next=9;break}return n.prev=1,n.next=4,l.logout();case 4:n.next=9;break;case 6:n.prev=6,n.t0=n["catch"](1),i.error(n.t0);case 9:uni.removeStorageSync("uni_id_token"),uni.setStorageSync("uni_id_token_expired",0),uni.redirectTo({url:"/".concat(null!==(a=null===(o=s.default.uniIdRouter)||void 0===o?void 0:o.loginPage)&&void 0!==a?a:"uni_modules/uni-id-pages/pages/login/login-withoutpwd")}),uni.$emit("uni-id-pages-logout"),t.setUserInfo({},{cover:!0});case 14:case"end":return n.stop()}}),n,null,[[1,6]])})))()},loginBack:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.uniIdRedirectUrl,n=void 0===t?"":t,i=0,a=getCurrentPages();if(a.forEach((function(e,t){"login"==a[a.length-t-1].route.split("/")[3]&&i++})),n)return uni.reLaunch({url:n});if("weixin"==e.loginType)return window.history.go(-3);if(i){var r=s.default.pages[0];return uni.reLaunch({url:"/".concat(r.path)})}uni.navigateBack({delta:i})},loginSuccess:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.showToast,n=void 0===t||t,a=e.toastText,r=void 0===a?"登录成功":a,o=e.autoBack,u=void 0===o||o,s=e.uniIdRedirectUrl,d=void 0===s?"":s,l=e.passwordConfirmed;if(n&&uni.showToast({title:r,icon:"none",duration:3e3}),this.updateUserInfo(),uni.$emit("uni-id-pages-login-success"),c.default.setPasswordAfterLogin&&!l)return uni.redirectTo({url:d?"/uni_modules/uni-id-pages/pages/userinfo/set-pwd/set-pwd?uniIdRedirectUrl=".concat(d,"&loginType=").concat(e.loginType):"/uni_modules/uni-id-pages/pages/userinfo/set-pwd/set-pwd?loginType=".concat(e.loginType),fail:function(e){i.log(e)}});u&&this.loginBack(d)}};t.mutations=x;var h=d.default.observable(g);t.store=h}).call(this,n("a9ff")["default"],n("5a52")["default"])},ecb3:function(e,t,n){var i=n("5dde");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("4f06").default;a("7af6e9a2",i,!0,{sourceMap:!1,shadowMode:!1})}}]);